<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Soil Transport PDF Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; padding: 20px; }
    .container { 
      max-width: 800px; 
      margin: auto; 
      background: #fff; 
      padding: 40px; 
      border-radius: 8px; 
      box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
    }
    #pdf-content { padding: 10px; } /* The area we will screenshot */
    
    h1 { text-align: center; color: #1a73e8; margin-bottom: 30px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
    
    .field-box { border-bottom: 1px dashed #ccc; padding: 5px 0; }
    .label { font-weight: bold; color: #555; font-size: 14px; }
    .value { font-size: 16px; margin-left: 10px; }

    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th { background: #1a73e8; color: white; padding: 12px; border: 1px solid #1a73e8; }
    td { padding: 10px; border: 1px solid #dee2e6; text-align: center; }
    
    input { width: 90%; padding: 5px; border: 1px solid #ddd; border-radius: 4px; }
    
    .actions { margin-top: 25px; display: flex; gap: 10px; justify-content: center; }
    button { padding: 12px 24px; cursor: pointer; border: none; border-radius: 6px; font-weight: bold; }
    .add-btn { background: #e8f0fe; color: #1a73e8; }
    .pdf-btn { background: #34a853; color: #fff; }
    
    .total-section { margin-top: 30px; text-align: right; font-size: 22px; font-weight: bold; color: #222; }
    
    /* Hide inputs and buttons during screenshot if needed, 
       but here we will just capture the container state */
    .no-print { display: none; }
  </style>
</head>
<body>

<div class="container" id="capture-area">
  <div style="text-align:right;" id="ui-controls">
    <select id="language" onchange="setLanguage()">
      <option value="en">English</option>
      <option value="mr" selected>मराठी</option>
    </select>
  </div>

  <div id="pdf-content">
    <h1 id="title">माती वाहतूक करार अहवाल</h1>

    <div class="grid">
      <div class="field-box">
        <span class="label" id="vendorLabel">विक्रेता नाव</span>: 
        <input id="vendor" placeholder="..." />
      </div>
      <div class="field-box">
        <span class="label" id="vendorContactLabel">विक्रेता संपर्क</span>: 
        <input id="vendorContact" />
      </div>
      <div class="field-box">
        <span class="label" id="contractorLabel">ठेकेदार नाव</span>: 
        <input id="contractor" />
      </div>
      <div class="field-box">
        <span class="label" id="contractorContactLabel">ठेकेदार संपर्क</span>: 
        <input id="contractorContact" />
      </div>
    </div>

    <table id="tripTable">
      <thead>
        <tr>
          <th id="thTrip">फेरीचे वर्णन</th>
          <th id="thCost">प्रति फेरी खर्च</th>
          <th id="thTrips">फेऱ्यांची संख्या</th>
          <th id="thTotal">एकूण खर्च</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input placeholder="Details" /></td>
          <td><input type="number" value="0" oninput="calculate()" /></td>
          <td><input type="number" value="0" oninput="calculate()" /></td>
          <td class="rowTotal">0</td>
        </tr>
      </tbody>
    </table>

    <div class="total-section" id="grandTotal">एकूण रक्कम: 0</div>
  </div>

  <div class="actions" id="action-buttons">
    <button class="add-btn" onclick="addTrip()" id="addTripBtn">फेरी जोडा</button>
    <button class="pdf-btn" onclick="downloadScreenshotPDF()" id="pdfBtn">PDF डाउनलोड करा</button>
  </div>
</div>

<script>
const translations = {
  en: { title: 'Soil Transportation Report', vendor: 'Vendor Name', vCon: 'Vendor Contact', contractor: 'Contractor Name', cCon: 'Contractor Contact', trip: 'Description', cost: 'Cost/Trip', qty: 'Trips', total: 'Total', add: 'Add Trip', pdf: 'Download PDF', grand: 'Grand Total' },
  mr: { title: 'माती वाहतूक करार अहवाल', vendor: 'विक्रेता नाव', vCon: 'विक्रेता संपर्क', contractor: 'ठेकेदार नाव', cCon: 'ठेकेदार संपर्क', trip: 'फेरीचे वर्णन', cost: 'प्रति फेरी खर्च', qty: 'फेऱ्यांची संख्या', total: 'एकूण खर्च', add: 'फेरी जोडा', pdf: 'PDF डाउनलोड करा', grand: 'एकूण रक्कम' }
};

function setLanguage() {
  const lang = document.getElementById('language').value;
  const t = translations[lang];
  document.getElementById('title').innerText = t.title;
  document.getElementById('vendorLabel').innerText = t.vendor;
  document.getElementById('vendorContactLabel').innerText = t.vCon;
  document.getElementById('contractorLabel').innerText = t.contractor;
  document.getElementById('contractorContactLabel').innerText = t.cCon;
  document.getElementById('thTrip').innerText = t.trip;
  document.getElementById('thCost').innerText = t.cost;
  document.getElementById('thTrips').innerText = t.qty;
  document.getElementById('thTotal').innerText = t.total;
  document.getElementById('addTripBtn').innerText = t.add;
  document.getElementById('pdfBtn').innerText = t.pdf;
  calculate();
}

function addTrip() {
  const tbody = document.querySelector('#tripTable tbody');
  const row = document.createElement('tr');
  row.innerHTML = `<td><input /></td><td><input type="number" value="0" oninput="calculate()" /></td><td><input type="number" value="0" oninput="calculate()" /></td><td class="rowTotal">0</td>`;
  tbody.appendChild(row);
}

function calculate() {
  let grand = 0;
  document.querySelectorAll('#tripTable tbody tr').forEach(row => {
    const cost = Number(row.children[1].querySelector('input').value) || 0;
    const qty = Number(row.children[2].querySelector('input').value) || 0;
    const total = cost * qty;
    row.querySelector('.rowTotal').innerText = total;
    grand += total;
  });
  const lang = document.getElementById('language').value;
  document.getElementById('grandTotal').innerText = `${translations[lang].grand}: ${grand}`;
}

async function downloadScreenshotPDF() {
  const { jsPDF } = window.jspdf;
  
  // 1. Temporarily hide UI elements we don't want in the PDF
  const ui = document.getElementById('ui-controls');
  const buttons = document.getElementById('action-buttons');
  ui.style.visibility = 'hidden';
  buttons.style.visibility = 'hidden';

  // 2. Capture the container as a canvas
  const element = document.getElementById('capture-area');
  
  html2canvas(element, {
    scale: 2, // Higher scale for better quality
    useCORS: true,
    logging: false
  }).then(canvas => {
    const imgData = canvas.toDataURL('image/png');
    
    // 3. Create PDF
    const pdf = new jsPDF('p', 'mm', 'a4');
    const imgProps = pdf.getImageProperties(imgData);
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
    
    pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
    pdf.save("Report.pdf");

    // 4. Show UI elements back
    ui.style.visibility = 'visible';
    buttons.style.visibility = 'visible';
  });
}
</script>
</body>
</html>
